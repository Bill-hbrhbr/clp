version: "3"

includes:
  cmake-libs:
    flatten: true
    taskfile: "cmake-libs.yaml"
  core:
    flatten: true
    taskfile: "core.yaml"
  misc-libs:
    flatten: true
    taskfile: "misc-libs.yaml"
  spider:
    flatten: true
    taskfile: "spider.yaml"
  log-viewer:
    flatten: true
    taskfile: "log-viewer.yaml"
  utils: "utils.yaml"
  yscope-dev-utils: "../../tools/yscope-dev-utils/exports/taskfiles/utils/utils.yaml"

vars:
  # Directories
  G_DEPS_DIR: "{{.G_BUILD_DIR}}/deps"
  G_DEPS_CPP_DIR: "{{.G_DEPS_DIR}}/cpp"
  G_DEPS_CPP_CHECKSUMS_DIR: "{{.G_DEPS_CPP_DIR}}/checksums"

  # Checksum file paths
  G_DEPS_CPP_CHECKSUM_FILE: "{{.G_DEPS_CPP_CHECKSUMS_DIR}}/all.md5"
  G_DEPS_LOG_VIEWER_CHECKSUM_FILE: "{{.G_DEPS_DIR}}/log-viewer.md5"

  # NOTE: This must be kept in-sync with its usage in components/core/CMakeLists.txt
  G_DEPS_CPP_CMAKE_SETTINGS_DIR: "{{.G_DEPS_CPP_DIR}}/cmake-settings"

  # Library names
  G_BOOST_LIB_NAME: "Boost"
  G_FMT_LIB_NAME: "fmt"
  G_GSL_LIB_NAME: "Microsoft.GSL"

  # Antlr
  G_ANTLR_VERSION: "4.13.2"
  G_ANTLR_JAR_FILE: "{{.G_DEPS_CPP_DIR}}/antlr-{{.G_ANTLR_VERSION}}-complete.jar"

tasks:
  default:
    deps:
      - "core"
      - "log-viewer"

  init:
    internal: true
    run: "once"
    cmds:
      - "mkdir -p '{{.G_DEPS_DIR}}'"
      - "mkdir -p '{{.G_DEPS_CPP_DIR}}'"
      - "mkdir -p '{{.G_DEPS_CPP_CHECKSUMS_DIR}}'"
      - "mkdir -p '{{.G_DEPS_CPP_CMAKE_SETTINGS_DIR}}'"
